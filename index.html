<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Product Gallery & PDF Export</title>
  <style>
    
    :root{
      --accent:#6b46c1;
      --muted:#666;
      --card-bg:#fff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    body{
      margin:0;
      background:#f5f5f8;
      color:#222;
      -webkit-font-smoothing:antialiased;
      padding-bottom:96px;
    }
    header{
      background:linear-gradient(90deg,var(--accent),#9f7aea);
      color:white;
      padding:14px 12px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    header h1{
      font-size:18px;
      margin:0;
      line-height:1;
    }
    .toolbar{
      margin-left:auto;
      font-size:13px;
      opacity:.95;
    }

    .filters{
      padding:10px 12px;
      display:flex;
      gap:8px;
      overflow:auto;
      background:white;
      box-shadow:0 1px 0 rgba(0,0,0,.04);
    }
    .filter{
      background:#eee;
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
      padding:12px;
    }
    @media (min-width:640px){
      .grid{ grid-template-columns:repeat(4,1fr); padding:16px; }
      header h1{ font-size:20px; }
    }
    .card{
      background:var(--card-bg);
      border-radius:10px;
      padding:8px;
      box-shadow:0 6px 12px rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      align-items:stretch;
      min-height:140px;
    }
    .imgwrap{
      background:linear-gradient(180deg,#fff,#f3f3f6);
      height:92px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .imgwrap img{ width:100%; height:100%; object-fit:cover; }
    .title{
      font-size:13px;
      margin-top:8px;
      font-weight:600;
      min-height:34px;
    }
    .meta{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .btn{
      border:0;
      background:var(--accent);
      color:white;
      padding:8px 10px;
      border-radius:8px;
      font-size:13px;
      cursor:pointer;
    }
    .btn.secondary{
      background:#eee;
      color:#333;
    }
    .bottom-actions{
      position:fixed;
      left:0;
      right:0;
      bottom:0;
      background:linear-gradient(180deg,#fff0,#fff);
      padding:10px 12px;
      display:flex;
      gap:8px;
      justify-content:space-between;
      align-items:center;
    }

    /* Customize panel */
    .custom-panel{
      margin:12px;
      background:white;
      border-radius:10px;
      padding:12px;
      box-shadow:0 6px 12px rgba(0,0,0,.05);
    }
    label{font-size:13px; color:#333; display:block; margin-top:8px; margin-bottom:6px;}
    input[type="text"], input[type="tel"], textarea, select{
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #ddd;
      font-size:14px;
      box-sizing:border-box;
    }
    textarea{ min-height:80px; resize:vertical; }

    /* Cart list small */
    .cart-list{ font-size:14px; color:#222; }
    .cart-item{ display:flex; gap:8px; align-items:center; padding:6px 0; border-bottom:1px dashed #eee; }
    .cart-item strong{ font-size:13px; }
    .badge{ background:#f3f3f6; padding:4px 6px; border-radius:6px; font-size:12px; }

    /* modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      justify-content:center;
      align-items:center;
      background:rgba(0,0,0,.45);
      z-index:50;
    }
    .modal.show{ display:flex; }
    .modal-card{
      width:92%;
      max-width:480px;
      background:white;
      border-radius:10px;
      padding:12px;
    }
  </style>
</head>
<body>
  <header>
    <div style="width:36px;height:36px;background:white;border-radius:8px;display:flex;align-items:center;justify-content:center;">
      <span style="color:var(--accent);font-weight:700">P</span>
    </div>
    <h1>Designs — Royal Look</h1>
    <div class="toolbar">Tap product → customize</div>
  </header>

  <div class="filters" id="filters">
    <div class="filter">All</div>
    <div class="filter">Best</div>
    <div class="filter">New</div>
    <div class="filter">Custom</div>
  </div>

  <div class="grid" id="productGrid"></div>

  <div class="custom-panel" id="customPanel">
  <h3 style="margin:0 0 8px 0">Order Details</h3>

  <form id="orderForm" action="https://formspree.io/f/xqajjljd" method="POST">
    
    <label>Your Name</label>
    <input type="text" name="name" id="yourName" placeholder="Full name" required>

    <label>Phone Number</label>
    <input type="tel" name="phone" id="contact" placeholder="Phone or email" required>

    <label>Address</label>
    <textarea name="address" id="userAddress" placeholder="Full address" required></textarea>

    <label>Custom Design Notes (optional)</label>
    <textarea name="customNotes" id="about" placeholder="Write any special instructions..."></textarea>

    <input type="hidden" name="orderData" id="orderData" />
  </form>

  <div style="display:flex;gap:8px;margin-top:10px;align-items:center;">
    
    <button class="btn" id="generatePdfAndSendOrder">
      Generate PDF & Send Order
    </button>

    <div style="flex:1"></div>
    <div class="badge" id="cartCount">Cart: 0</div>
  </div>
</div>

  <div class="bottom-actions">
    <div style="font-size:13px;color:#333">Selected: <span id="selSummary">—</span></div>
    <div style="display:flex;gap:8px;">
      <button class="btn secondary" id="clearCart">Clear</button>
      <button class="btn" id="viewCart">View Cart</button>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-card">
      <h3 style="margin:0 0 8px 0">Cart</h3>
      <div class="cart-list" id="cartList"></div>
      <div style="display:flex;gap:8px;margin-top:10px;justify-content:flex-end;">
        <button class="btn secondary" id="closeModal">Close</button>
        <button class="btn" id="modalSubmit">Generate PDF & Send</button> 
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <script>
    // **********************************************
    // 1. PRODUCT DATA (Unchanged)
    // **********************************************
    const products = [
      { id: 'PIC1', title: 'Pic 1 — Royal', price: '₹499', img: "image/1.jpg" },
      { id: 'PIC2', title: 'Pic 2 — Royal', price: '₹499', img: "image/2.jpg" },
      { id: 'PIC3', title: 'Pic 3 — Royal', price: '₹549', img: "image/3.jpg" },
      { id: 'PIC4', title: 'Pic 4 — Royal', price: '₹399', img: "image/4.jpg" },
      { id: 'PIC5', title: 'Pic 5 — Royal', price: '₹599', img: "image/5.jpg" },
      { id: 'PIC6', title: 'Pic 6 — Royal', price: '₹499', img: "image/6.png" },
      { id: 'PIC7', title: 'Pic 7 — Royal', price: '₹499', img: "image/7.png" },
      { id: 'PIC8', title: 'Pic 8 — Royal', price: '₹699', img: "image/8.png" },
      { id: 'PIC9', title: 'Pic 9 — Royal', price: '₹399', img: "image/9.jpg" },
      { id: 'PIC10', title: 'Pic 10 — Royal', price: '₹399', img: "image/10.jpg" },
      { id: 'PIC11', title: 'Pic 11 — Royal', price: '₹799', img: "image/11.jpg" },
      { id: 'PIC12', title: 'Pic 12 — Royal', price: '₹499', img: "image/12.jpg" }
    ];

    function makePlaceholder(text){
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'>
        <rect width='100%' height='100%' fill='#f8fafc'/>
        <text x='50%' y='50%' font-family='Arial' font-size='32' dominant-baseline='middle' text-anchor='middle' fill='#999'>${text}</text>
      </svg>`;
      return 'data:image/svg+xml;base64,' + btoa(svg);
    }
    products.forEach(p => { if(!p.img) p.img = makePlaceholder(p.id); });

    const grid = document.getElementById('productGrid');
    const cart = [];
    const cartCountEl = document.getElementById('cartCount');
    const selSummary = document.getElementById('selSummary');

    // **********************************************
    // 2. GRID & CART UI LOGIC (Unchanged)
    // **********************************************
    function renderGrid(){
      grid.innerHTML = '';
      products.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="imgwrap"><img src="${p.img}" alt="${p.title}" /></div>
          <div class="title">${p.title}</div>
          <div class="meta">
            <div>${p.price}</div>
            <div>
              <button class="btn btn-add" data-id="${p.id}">Add</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });

      document.querySelectorAll('.btn-add').forEach(btn => {
        btn.addEventListener('click', e => {
          const id = e.currentTarget.dataset.id;
          const fullProduct = products.find(prod => prod.id === id);
          if (fullProduct) {
             cart.push(Object.assign({}, fullProduct)); 
          }
          updateCartUI();
        });
      });
    }

    function updateCartUI(){
      cartCountEl.textContent = 'Cart: ' + cart.length;
      selSummary.textContent = cart.length ? cart.map(c=>c.id).join(', ') : '—';
    }

    document.getElementById('clearCart').addEventListener('click', ()=>{
      cart.length = 0;
      updateCartUI();
    });

    const modal = document.getElementById('modal');
    const cartList = document.getElementById('cartList');
    document.getElementById('viewCart').addEventListener('click', ()=>{
      renderCartList();
      modal.classList.add('show');
    });
    document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.remove('show'));

    function renderCartList(){
      if(cart.length === 0){
        cartList.innerHTML = '<div style="padding:8px;color:#666">No items selected.</div>';
        return;
      }
      cartList.innerHTML = '';
      cart.forEach((c, i) => {
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `<div style="flex:1"><strong>${c.title}</strong><div style="font-size:12px;color:#666">${c.price} • ${c.id}</div></div>
          <div><button class="btn secondary" data-i="${i}">Remove</button></div>`;
        cartList.appendChild(row);
      });
      cartList.querySelectorAll('button[data-i]').forEach(b=>{
        b.addEventListener('click', e=>{
          const i = +e.currentTarget.dataset.i;
          cart.splice(i,1);
          renderCartList();
          updateCartUI();
        });
      });
    }

    // **********************************************
    // 3. PDF GENERATION LOGIC
    // **********************************************
    function escapeHtml(str){
      return String(str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
    }

    function createPdfContent(){
      const name = document.getElementById('yourName').value || '(no name)';
      const contact = document.getElementById('contact').value || '(no contact)';
      const address = document.getElementById('userAddress').value || '(no address)';
      const notes = document.getElementById('about').value || '';

      const wrapper = document.createElement('div');
      wrapper.style.padding = '14px';
      wrapper.style.fontFamily = 'Arial, Helvetica, sans-serif';
      wrapper.style.color = '#111';
      wrapper.innerHTML = `
        <h2 style="margin:0 0 8px 0">Order / Design Summary</h2>
        <div style="margin-bottom:8px;font-size:14px;">
          <strong>Name:</strong> ${escapeHtml(name)}<br/>
          <strong>Contact:</strong> ${escapeHtml(contact)}<br/>
          <strong>Address:</strong> ${escapeHtml(address)}<br/>
          <strong>Notes:</strong> ${escapeHtml(notes)}<br/>
        </div>
        <hr/>
        <h3 style="margin:8px 0">Selected Designs</h3>
      `;

      if(cart.length === 0){
        wrapper.innerHTML += `<div style="color:#666">No products selected.</div>`;
      } else {
        const griddiv = document.createElement('div');
        griddiv.style.display='grid';
        griddiv.style.gridTemplateColumns='repeat(2,1fr)';
        griddiv.style.gap='8px';
        cart.forEach(c=>{
          const box = document.createElement('div');
          box.style.border='1px solid #ddd';
          box.style.padding='8px';
          box.style.borderRadius='8px';
          box.innerHTML = `
            <div style="font-weight:700;margin-bottom:6px">${escapeHtml(c.title)}</div>
            <div style="font-size:13px;color:#444">${escapeHtml(c.price)} • ${escapeHtml(c.id)}</div>
          `;
          const img = document.createElement('img');
          img.src = c.img;
          img.style.width='100%';
          img.style.height='90px';
          img.style.objectFit='cover';
          img.style.marginTop='8px';
          img.style.borderRadius='6px';
          box.appendChild(img);

          griddiv.appendChild(box);
        });
        wrapper.appendChild(griddiv);
      }
      return wrapper;
    }

    async function generatePdfAction(){
      const content = createPdfContent();
      document.body.appendChild(content); 
      const opt = {
        margin: 10,
        filename: `Order_Design_Summary_${Date.now()}.pdf`,
        image: { type: 'jpeg', quality: 0.95 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      
      let pdfSaved = false;
      try {
        await html2pdf().set(opt).from(content).save();
        pdfSaved = true;
        // User will see this message after download starts
        alert('PDF generated and downloaded. Now submitting order details via email.'); 
      } catch (err) {
        alert('PDF generation failed. Order details will still be sent. Error: ' + err.message);
      } finally {
        document.body.removeChild(content);
        return pdfSaved;
      }
    }


    // **********************************************
    // 4. COMBINED ACTION: PDF + FORMSPREE SUBMISSION (New)
    // **********************************************
    
    // Helper function to format cart data for the hidden 'orderData' field
    function formatCartDataForFormspree() {
      let text = "--- Order Items ---\n";
      let total = 0;
      
      cart.forEach(item => {
        text += `• ${item.title} (ID: ${item.id}) - ${item.price}\n`;
        const priceMatch = item.price.match(/[\d\.]+/);
        if (priceMatch) {
            total += Number(priceMatch[0]);
        }
      });
      text += `\nTotal Estimated Price: ₹${total.toFixed(0)}\n-------------------\n`;
      return text;
    }

    async function generatePdfAndSendOrder() {
      // 1. Basic Validation
      const form = document.getElementById("orderForm");
      if (!form.reportValidity()) {
        alert("Please fill in all required fields (Name, Phone, Address).");
        return; 
      }
      if (cart.length === 0) {
        alert("Your cart is empty! Please add products before sending.");
        return;
      }

      // 2. Generate PDF (Download happens first)
      await generatePdfAction();

      // 3. Prepare Cart Data for Formspree
      document.getElementById("orderData").value = formatCartDataForFormspree();

      // 4. Submit to Formspree
      // Note: Formspree automatically handles the submission of all fields inside the form
      // including name, phone, address, customNotes, and the hidden orderData.
      form.submit();
    }

    // Attach the combined function to the main button
    document.getElementById('generatePdfAndSendOrder').addEventListener('click', generatePdfAndSendOrder);
    
    // Also attach to the modal button to reuse the logic
    document.getElementById('modalSubmit').addEventListener('click', ()=>{
      document.getElementById('modal').classList.remove('show');
      generatePdfAndSendOrder();
    });
    
    // Initial Render
    renderGrid();
    updateCartUI();
  </script>
</body>
</html>
